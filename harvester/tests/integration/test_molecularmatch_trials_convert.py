from harvesters import molecularmatch_trials
import json
from collections import namedtuple
from lookups import evidence_label as el

EVIDENCE = json.loads("""
{"status": "Recruiting", "startDate": "June 2016", "title": "Hyperpolarized Xenon-129 Functional Magnetic Resonance Imaging of Healthy Volunteers and Participants With Alzheimer's Disease", "molecularAlterations": [], "_score": -7, "interventions": [{"intervention_name": "Traditional Proton fMRI", "description": "Conventional proton fMRI will be performed. During the functional imaging acquisitions, the participant will be asked by the research team to perform simple tasks. These tasks will be completed while the participant breathes air (normal breathing).", "arm_group_label": ["Healthy Volunteers", "Alzheimer's Disease Participants"], "intervention_type": "Other"}, {"intervention_name": "Hyperpolarized Xenon-129 fMRI", "other_name": "HP 129Xe fMRI", "description": "HP 129Xe fMRI data will be acquired from all participants. Hyperpolarized xenon (NeuroXene) is expected to produce images that provide more clinically relevant information than traditional proton scans. Simple tasks will be performed by participants while breathing NeuroXene according to several inhalation procedures.", "arm_group_label": ["Healthy Volunteers", "Alzheimer's Disease Participants"], "intervention_type": "Other"}, {"intervention_name": "Hyperpolarized Xenon-129", "other_name": "NeuroXene", "description": "Participants will be asked to inhale specified amounts of NeuroXene according to several inhalation procedures. NeuroXene is the trade name for hyperpolarization of xenon-129 balanced with oxygen and nitrogen using a Xemed LLC polarizer. Hyperpolarization does not change the chemical or physical properties of xenon gas.", "arm_group_label": ["Healthy Volunteers", "Alzheimer's Disease Participants"], "intervention_type": "Drug"}, {"intervention_name": "1H-129Xe Dual-Tuned Quadrature Head Coil", "description": "A 1H-129Xe dual-tuned quadrature head coil (Clinical MR Solutions, LLC) will be used in this study. The RF coil will be used to acquire MRI images of the human brain after inhalation of hyperpolarized xenon-129 gas, and permits the acquisition of both conventional proton and HP xenon gas images.", "arm_group_label": ["Healthy Volunteers", "Alzheimer's Disease Participants"], "intervention_type": "Device"}], "locations": [{"status": "Recruiting", "city": "Thunder Bay", "last_name": "Mitchell S Albert, PhD", "phone_backup": "807-684-6958", "zip": "P7B 6V4", "country": "Canada", "last_name_backup": "Jennifer Plata, HBSc", "email": "albertmi@tbh.net", "phone": "807-684-7270", "state": "Ontario", "email_backup": "plataj@tbh.net", "geo": {"lat": 48.416, "lon": -89.267}, "id": "thunderbayregionalhealthsciencescentre_thunderbay_ontario_ca_p7b6v4", "name": "Thunder Bay Regional Health Sciences Centre"}], "briefTitle": "HP Xenon-129 fMRI of Healthy Volunteers and Participants With Alzheimer's Disease", "overallContact": {"phone": "807-684-7270", "last_name": "Mitchell Albert, Ph.D.", "email": "albertmi@tbh.net"}, "phase": "Early Phase 1", "tags": [{"facet": "DRUG", "compositeKey": "Oxygen compressedDRUGinclude", "suppress": false, "filterType": "include", "term": "Oxygen compressed", "custom": false, "priority": 1, "alias": "Oxygen compressed"}, {"facet": "DRUG", "compositeKey": "NitrogenDRUGinclude", "suppress": false, "filterType": "include", "term": "Nitrogen", "custom": false, "priority": 1, "alias": "Nirtogen"}, {"facet": "DRUG", "compositeKey": "Xenon xe-133DRUGinclude", "suppress": false, "filterType": "include", "term": "Xenon xe-133", "custom": false, "priority": 1, "alias": "Xenon xe-133"}, {"facet": "DRUGCLASS", "compositeKey": "Inhalation Diagnostic AgentDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Inhalation Diagnostic Agent", "custom": false, "priority": 0, "alias": "Inhalation Diagnostic Agent", "generatedByTerm": "Xenon xe-133"}, {"facet": "DRUGCLASS", "compositeKey": "Radiopharmaceutical ActivityDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Radiopharmaceutical Activity", "custom": false, "priority": 0, "alias": "Radiopharmaceutical Activity", "generatedByTerm": "Xenon xe-133"}, {"facet": "DRUG", "compositeKey": "NirtogenDRUGinclude", "suppress": false, "filterType": "include", "term": "Nirtogen", "custom": false, "priority": 1, "alias": "Nirtogen"}, {"facet": "CONDITION", "compositeKey": "DementiaCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Dementia", "custom": false, "priority": 1, "alias": "Dementia"}, {"facet": "CONDITION", "compositeKey": "Infective disorderCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Infective disorder", "custom": false, "priority": 1, "alias": "Infection"}, {"facet": "PHASE", "compositeKey": "Phase 1PHASEinclude", "suppress": false, "filterType": "include", "term": "Phase 1", "custom": false, "priority": 1, "alias": "Phase 1"}, {"facet": "CONDITION", "compositeKey": "AD - Alzheimer's diseaseCONDITIONinclude", "suppress": false, "filterType": "include", "term": "AD - Alzheimer's disease", "custom": false, "priority": 1, "alias": "AD - Alzheimer's disease"}, {"facet": "SITE", "compositeKey": "CerebralSITEinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Cerebral", "custom": false, "priority": 0, "alias": "Cerebral", "generatedByTerm": "AD - Alzheimer's disease"}, {"facet": "FINDING", "compositeKey": "Pregnancy confirmedFINDINGexclude", "suppress": false, "filterType": "exclude", "term": "Pregnancy confirmed", "custom": false, "priority": 1, "alias": "Pregnant"}, {"facet": "GENE", "compositeKey": "HPGENEinclude", "suppress": false, "filterType": "include", "term": "HP", "custom": false, "priority": 1, "alias": "HP"}, {"facet": "GENE", "compositeKey": "PTPRFGENEinclude", "suppress": false, "filterType": "include", "term": "PTPRF", "custom": false, "priority": 2, "alias": "PTPRF"}, {"facet": "STATUS", "compositeKey": "RecruitingSTATUSinclude", "suppress": false, "filterType": "include", "term": "Recruiting", "custom": false, "priority": 1, "alias": "Recruiting"}, {"facet": "TRIALTYPE", "compositeKey": "DiagnosticTRIALTYPEinclude", "suppress": false, "filterType": "include", "term": "Diagnostic", "custom": false, "priority": 1, "alias": "Diagnostic"}, {"facet": "TRIALTYPE", "compositeKey": "InterventionalTRIALTYPEinclude", "suppress": false, "filterType": "include", "term": "Interventional", "custom": false, "priority": 1, "alias": "Interventional"}], "id": "NCT02638519", "studyType": "Interventional"}
""")  # NOQA


PHENOTYPE = json.loads("""
{"status": "Recruiting", "startDate": "April 2016", "interventions": [{"intervention_name": "Trabectedin", "arm_group_label": "Trabectedin", "other_name": "Yondelis", "intervention_type": "Drug"}, {"intervention_name": "Pegylated Liposomal Doxorubicin", "arm_group_label": "Standard Treatment", "intervention_type": "Drug"}, {"intervention_name": "Topotecan", "arm_group_label": "Standard Treatment", "intervention_type": "Drug"}, {"intervention_name": "Gemcitabine", "arm_group_label": "Standard Treatment", "intervention_type": "Drug"}, {"intervention_name": "Weekly Paclitaxel", "arm_group_label": "Standard Treatment", "intervention_type": "Drug"}, {"intervention_name": "Carboplatin", "arm_group_label": "Standard Treatment", "intervention_type": "Drug"}], "molecularAlterations": [], "_score": 24, "title": "Randomized Phase III Trial on Trabectedin (ET-743) vs Clinician's Choice Chemotherapy in Recurrent Ovarian, Primary Peritoneal or Fallopian Tube Cancers of BRCA Mutated or BRCAness Phenotype patients_MITO-23", "locations": [{"status": "Recruiting", "city": "Milan", "last_name": "Domenica Lorusso, MD", "phone_backup": "+390223903818", "zip": "20133", "created": "2016-09-18T00:42:50.831Z", "_validMessage": "geocoder failed", "country": "Italy", "last_name_backup": "Elisa Grassi", "lastUpdated": "2017-12-29T12:51:07.590Z", "email": "domenica.lorusso@istitutotumori.mi.it", "phone": "+390223903697", "state": "", "failedGeocode": true, "email_backup": "elisa.grassi@istitutotumori.mi.it", "id": "domenicalorusso_milan_it_20133", "_valid": false, "name": "Domenica Lorusso"}], "briefTitle": "Trial on Trabectedin (ET-743) vs Clinician's Choice Chemotherapy in Recurrent Ovarian, Primary Peritoneal or Fallopian Tube Cancers of BRCA Mutated or BRCAness Phenotype Patients _MITO-23", "overallContact": {"phone": "+390223903697", "last_name": "Domenica Lorusso, MD", "email": "domenica.lorusso@istitutotumori.mi.it"}, "link": "http://clinicaltrials.gov/ct2/show/NCT02903004", "studyType": "Interventional", "phase": "Phase 3", "id": "NCT02903004", "tags": [{"priority": 1, "compositeKey": "Ovarian CaCONDITIONinclude", "suppress": false, "generatedBy": "", "filterType": "include", "term": "Ovarian Ca", "custom": true, "facet": "CONDITION", "alias": "Ovarian cancer", "manualSuppress": 0, "generatedByTerm": ""}, {"priority": 1, "compositeKey": "Carcinoma of ovaryCONDITIONinclude", "suppress": false, "generatedBy": "", "filterType": "include", "term": "Carcinoma of ovary", "custom": true, "facet": "CONDITION", "alias": "Carcinoma of ovary", "manualSuppress": 0, "generatedByTerm": ""}, {"priority": 1, "compositeKey": "Carcinoma of peritoneumCONDITIONinclude", "suppress": false, "generatedBy": "", "filterType": "include", "term": "Carcinoma of peritoneum", "custom": true, "facet": "CONDITION", "alias": "Primary Peritoneal Carcinoma", "manualSuppress": 0, "generatedByTerm": ""}, {"priority": 1, "compositeKey": "Tumour of fallopian tubeCONDITIONinclude", "suppress": false, "generatedBy": "", "filterType": "include", "term": "Tumour of fallopian tube", "custom": true, "facet": "CONDITION", "alias": "Fallopian tube cancer", "manualSuppress": 0, "generatedByTerm": ""}, {"priority": 2, "compositeKey": "PARP1GENEinclude", "suppress": false, "filterType": "include", "term": "PARP1", "custom": false, "facet": "GENE", "alias": "PARP1", "manualSuppress": 0}, {"priority": 3, "compositeKey": "BRCA1GENEinclude", "manualPriority": 3, "suppress": false, "filterType": "include", "term": "BRCA1", "custom": false, "facet": "GENE", "alias": "BRCA1", "manualSuppress": 0}, {"priority": 3, "compositeKey": "BRCAGENEinclude", "manualPriority": 3, "suppress": false, "filterType": "include", "term": "BRCA", "custom": false, "facet": "GENE", "alias": "BRCA", "manualSuppress": 0}, {"priority": 3, "compositeKey": "BRCA2GENEinclude", "manualPriority": 3, "suppress": false, "filterType": "include", "term": "BRCA2", "custom": false, "facet": "GENE", "alias": "BRCA2", "manualSuppress": 0}, {"priority": 1, "compositeKey": "Infective disorderCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Infective disorder", "custom": false, "facet": "CONDITION", "alias": "Infection", "manualSuppress": 0}, {"priority": 1, "compositeKey": "Carcinoma of cervixCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Carcinoma of cervix", "custom": false, "facet": "CONDITION", "alias": "Carcinoma of cervix", "manualSuppress": 0}, {"priority": 1, "compositeKey": "Platinum-based Drug resistanceRESISTANCEinclude", "suppress": false, "generatedBy": "DRUGCLASS", "filterType": "include", "term": "Platinum-based Drug resistance", "custom": false, "facet": "RESISTANCE", "alias": "Platinum-based Drug resistance", "manualSuppress": 0, "generatedByTerm": "Platinum-based Drug"}, {"priority": 1, "compositeKey": "Congestive cardiac failureCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Congestive cardiac failure", "custom": false, "facet": "CONDITION", "alias": "Congestive cardiac failure", "manualSuppress": 0}, {"priority": 1, "compositeKey": "MI - Myocardial infarctionCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "MI - Myocardial infarction", "custom": false, "facet": "CONDITION", "alias": "Heart attack", "manualSuppress": 0}, {"priority": 1, "compositeKey": "HF - Heart failureCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "HF - Heart failure", "custom": false, "facet": "CONDITION", "alias": "Heart failure", "manualSuppress": 0}, {"priority": 1, "compositeKey": "Carcinoma in situCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Carcinoma in situ", "custom": false, "facet": "CONDITION", "alias": "Carcinoma in situ", "manualSuppress": 0}, {"priority": 0, "compositeKey": "Secondary malignant neoplastic diseaseCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Secondary malignant neoplastic disease", "custom": false, "facet": "CONDITION", "alias": "Metastases", "manualSuppress": 0}, {"priority": 1, "compositeKey": "Gemcitabine hydrochlorideDRUGinclude", "suppress": false, "filterType": "include", "term": "Gemcitabine hydrochloride", "custom": false, "facet": "DRUG", "alias": "Gemcitabine hydrochloride", "manualSuppress": 0}, {"priority": 0, "compositeKey": "Nucleic Acid Synthesis InhibitorsDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Nucleic Acid Synthesis Inhibitors", "custom": false, "facet": "DRUGCLASS", "alias": "Nucleic Acid Synthesis Inhibitors", "manualSuppress": 0, "generatedByTerm": "Gemcitabine hydrochloride"}, {"priority": 0, "compositeKey": "Nucleoside Metabolic InhibitorDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Nucleoside Metabolic Inhibitor", "custom": false, "facet": "DRUGCLASS", "alias": "Nucleoside Metabolic Inhibitor", "generatedByTerm": "Gemcitabine hydrochloride"}, {"priority": 0, "compositeKey": "AdjuvantDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Adjuvant", "custom": false, "facet": "DRUGCLASS", "alias": "Adjuvant", "manualSuppress": 0, "generatedByTerm": "Paclitaxel"}, {"priority": 0, "compositeKey": "ChemotherapyDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Chemotherapy", "custom": false, "facet": "DRUGCLASS", "alias": "Chemotherapy", "manualSuppress": 0, "generatedByTerm": "Trabectedin"}, {"priority": 2, "compositeKey": "MUC16GENEinclude", "suppress": false, "filterType": "include", "term": "MUC16", "custom": false, "facet": "GENE", "alias": "CA-125", "manualSuppress": 0}, {"priority": 1, "compositeKey": "Phase 3PHASEinclude", "suppress": false, "filterType": "include", "term": "Phase 3", "custom": false, "facet": "PHASE", "alias": "Phase 3", "manualSuppress": 0}, {"priority": 1, "compositeKey": "RecruitingSTATUSinclude", "suppress": false, "filterType": "include", "term": "Recruiting", "custom": false, "facet": "STATUS", "alias": "Recruiting", "manualSuppress": 0}, {"priority": 1, "compositeKey": "Doxorubicin hydrochlorideDRUGinclude", "suppress": false, "filterType": "include", "term": "Doxorubicin hydrochloride", "custom": false, "facet": "DRUG", "alias": "Doxorubicin hydrochloride", "manualSuppress": 0}, {"priority": 0, "compositeKey": "Topoisomerase InhibitorDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Topoisomerase Inhibitor", "custom": false, "facet": "DRUGCLASS", "alias": "Topoisomerase Inhibitor", "generatedByTerm": "Topotecan hydrochloride"}, {"priority": 0, "compositeKey": "TOP1 inhibitorDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "TOP1 inhibitor", "custom": false, "facet": "DRUGCLASS", "alias": "TOP1 inhibitor", "generatedByTerm": "Topotecan hydrochloride"}, {"priority": 0, "compositeKey": "Topoisomerase inhibitorDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Topoisomerase inhibitor", "custom": false, "facet": "DRUGCLASS", "alias": "Topoisomerase Inhibitor", "manualSuppress": 0, "generatedByTerm": "Topotecan hydrochloride"}, {"priority": 0, "compositeKey": "Topoisomerase InhibitorsDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Topoisomerase Inhibitors", "custom": false, "facet": "DRUGCLASS", "alias": "Topoisomerase Inhibitors", "generatedByTerm": "Topotecan hydrochloride"}, {"priority": 0, "compositeKey": "Vinca AlkaloidDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Vinca Alkaloid", "custom": false, "facet": "DRUGCLASS", "alias": "Vinca Alkaloid", "manualSuppress": 0, "generatedByTerm": "Doxorubicin hydrochloride"}, {"priority": 0, "compositeKey": "Anthracycline Topoisomerase InhibitorDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Anthracycline Topoisomerase Inhibitor", "custom": false, "facet": "DRUGCLASS", "alias": "Anthracycline Topoisomerase Inhibitor", "generatedByTerm": "Doxorubicin hydrochloride"}, {"priority": 1, "compositeKey": "Topotecan hydrochlorideDRUGinclude", "suppress": false, "filterType": "include", "term": "Topotecan hydrochloride", "custom": false, "facet": "DRUG", "alias": "Topotecan hydrochloride", "manualSuppress": 0}, {"priority": 1, "compositeKey": "PaclitaxelDRUGinclude", "suppress": false, "filterType": "include", "term": "Paclitaxel", "custom": false, "facet": "DRUG", "alias": "Paclitaxel", "manualSuppress": 0}, {"priority": 0, "compositeKey": "Microtubule InhibitorDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Microtubule Inhibitor", "custom": false, "facet": "DRUGCLASS", "alias": "Microtubule Inhibitor", "generatedByTerm": "Paclitaxel"}, {"priority": 0, "compositeKey": "Microtubule inhibitorDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Microtubule inhibitor", "custom": false, "facet": "DRUGCLASS", "alias": "Microtubule inhibitor", "manualSuppress": 0, "generatedByTerm": "Paclitaxel"}, {"priority": 1, "compositeKey": "CarboplatinDRUGinclude", "suppress": false, "filterType": "include", "term": "Carboplatin", "custom": false, "facet": "DRUG", "alias": "Carboplatin", "manualSuppress": 0}, {"priority": 1, "compositeKey": "Superficial basal cell carcinomaCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Superficial basal cell carcinoma", "custom": false, "facet": "CONDITION", "alias": "Basal cell carcinoma", "manualSuppress": 0}, {"priority": 1, "compositeKey": "Jns002DRUGinclude", "suppress": false, "filterType": "include", "term": "Jns002", "custom": false, "facet": "DRUG", "alias": "Jns002", "manualSuppress": 0}, {"priority": 1, "compositeKey": "TrabectedinDRUGinclude", "suppress": false, "filterType": "include", "term": "Trabectedin", "custom": false, "facet": "DRUG", "alias": "Yondelis", "manualSuppress": 0}, {"priority": 0, "compositeKey": "Alkylating DrugDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Alkylating Drug", "custom": false, "facet": "DRUGCLASS", "alias": "Alkylating Drug", "generatedByTerm": "Trabectedin"}, {"priority": 1, "compositeKey": "RandomizedTRIALTYPEinclude", "suppress": false, "filterType": "include", "term": "Randomized", "custom": false, "facet": "TRIALTYPE", "alias": "Randomized", "manualSuppress": 0}, {"priority": 1, "compositeKey": "InterventionalTRIALTYPEinclude", "suppress": false, "filterType": "include", "term": "Interventional", "custom": false, "facet": "TRIALTYPE", "alias": "Interventional", "manualSuppress": 0}, {"priority": 1, "compositeKey": "Carcinoma, NOSCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Carcinoma, NOS", "custom": false, "facet": "CONDITION", "alias": "carcinoma of unknown primary site", "manualSuppress": 0}, {"priority": 1, "compositeKey": "DexamethasoneDRUGexclude", "suppress": false, "filterType": "exclude", "term": "Dexamethasone", "custom": false, "facet": "DRUG", "alias": "Dexamethasone", "manualSuppress": 0}, {"priority": 0, "compositeKey": "Malignant tumor of abdomenCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Malignant tumor of abdomen", "custom": false, "facet": "CONDITION", "alias": "Malignant tumor of abdomen", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}, {"priority": 0, "compositeKey": "Malignant tumor of soft tissue of abdomenCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Malignant tumor of soft tissue of abdomen", "custom": false, "facet": "CONDITION", "alias": "Malignant tumor of soft tissue of abdomen", "manualSuppress": 0, "generatedByTerm": "Carcinoma of peritoneum"}, {"priority": 0, "compositeKey": "Neoplasm of the peritoneumCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Neoplasm of the peritoneum", "custom": false, "facet": "CONDITION", "alias": "Neoplasm of the peritoneum", "manualSuppress": 0, "generatedByTerm": "Carcinoma of peritoneum"}, {"priority": 0, "compositeKey": "Malignant neoplastic diseaseCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Malignant neoplastic disease", "custom": false, "facet": "CONDITION", "alias": "Cancer", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}, {"priority": 0, "compositeKey": "Peritoneal cancerCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Peritoneal cancer", "custom": false, "facet": "CONDITION", "alias": "Peritoneal cancer", "manualSuppress": 0, "generatedByTerm": "Carcinoma of peritoneum"}, {"priority": 0, "compositeKey": "Neoplasm of soft tissues of abdomenCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Neoplasm of soft tissues of abdomen", "custom": false, "facet": "CONDITION", "alias": "Neoplasm of soft tissues of abdomen", "manualSuppress": 0, "generatedByTerm": "Carcinoma of peritoneum"}, {"priority": 0, "compositeKey": "Neoplasm of soft tissueCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Neoplasm of soft tissue", "custom": false, "facet": "CONDITION", "alias": "Soft tissues cancer", "manualSuppress": 0, "generatedByTerm": "Carcinoma of peritoneum"}, {"priority": 0, "compositeKey": "Neoplasm of connective tissuesCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Neoplasm of connective tissues", "custom": false, "facet": "CONDITION", "alias": "Connective tissue cancer", "manualSuppress": 0, "generatedByTerm": "Carcinoma of peritoneum"}, {"priority": 0, "compositeKey": "Neoplasm of soft tissues of trunkCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Neoplasm of soft tissues of trunk", "custom": false, "facet": "CONDITION", "alias": "Neoplasm of soft tissues of trunk", "manualSuppress": 0, "generatedByTerm": "Carcinoma of peritoneum"}, {"priority": 0, "compositeKey": "NeoplasiaCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Neoplasia", "custom": false, "facet": "CONDITION", "alias": "Neoplasia", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}, {"priority": 0, "compositeKey": "Malignant tumour of soft tissueCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Malignant tumour of soft tissue", "custom": false, "facet": "CONDITION", "alias": "Malignant tumour of soft tissue", "manualSuppress": 0, "generatedByTerm": "Carcinoma of peritoneum"}, {"priority": 0, "compositeKey": "Solid tumorCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Solid tumor", "custom": false, "facet": "CONDITION", "alias": "Solid tumor", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}, {"priority": 0, "compositeKey": "PeritoneumSITEinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Peritoneum", "custom": false, "facet": "SITE", "alias": "Peritoneum", "manualSuppress": 0, "generatedByTerm": "Carcinoma of peritoneum"}, {"priority": 0, "compositeKey": "Malignant neoplasm of genital structureCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Malignant neoplasm of genital structure", "custom": false, "facet": "CONDITION", "alias": "Malignant neoplasm of genital structure", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}, {"priority": 0, "compositeKey": "Tumour of ovaryCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Tumour of ovary", "custom": false, "facet": "CONDITION", "alias": "Tumour of ovary", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}, {"priority": 0, "compositeKey": "Malignant tumor of pelvisCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Malignant tumor of pelvis", "custom": false, "facet": "CONDITION", "alias": "Malignant tumor of pelvis", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}, {"priority": 0, "compositeKey": "Neoplasm of uterine adnexaCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Neoplasm of uterine adnexa", "custom": false, "facet": "CONDITION", "alias": "Uterine adnexa cancer", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}, {"priority": 0, "compositeKey": "Malignant neoplasm of uterine adnexaCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Malignant neoplasm of uterine adnexa", "custom": false, "facet": "CONDITION", "alias": "Malignant neoplasm of uterine adnexa", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}, {"priority": 0, "compositeKey": "Malignant tumour of female genital organCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Malignant tumour of female genital organ", "custom": false, "facet": "CONDITION", "alias": "Malignant tumour of female genital organ", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}, {"priority": 0, "compositeKey": "Malignant neoplasm of genitourinary organCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Malignant neoplasm of genitourinary organ", "custom": false, "facet": "CONDITION", "alias": "Malignant neoplasm of genitourinary organ", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}, {"priority": 0, "compositeKey": "OvarySITEinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Ovary", "custom": false, "facet": "SITE", "alias": "Ovary", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}, {"priority": 0, "compositeKey": "Salpinx uterinaSITEinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Salpinx uterina", "custom": false, "facet": "SITE", "alias": "Salpinx uterina", "manualSuppress": 0, "generatedByTerm": "Tumour of fallopian tube"}, {"priority": 0, "compositeKey": "Epithelial tumour of ovaryCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Epithelial tumour of ovary", "custom": false, "facet": "CONDITION", "alias": "Epithelial tumour of ovary", "manualSuppress": 0, "generatedByTerm": "Carcinoma of ovary"}]}
""")  # NOQA

phenotype2 = """
{"status": "Unknown status", "startDate": "August 2009", "interventions": [{"intervention_name": "endostar and CHOP", "arm_group_label": "treatment", "description": "endostar, 7.5m g/m2, intravenous, Day 2-15, repeat every 3 weeks\r\nCHOP: Cyclophosphamide, Hydroxydaunorubicin, Oncovin, Prednisone", "other_name": "endostar", "intervention_type": "Drug"}], "molecularAlterations": [], "_score": 18, "title": "Phase 2 Study of Endostar Combined With CHOP Regimen as the First Line Chemotherapy for Untreated Peripheral T Cell Lymphoma", "locations": [{"status": "Recruiting", "city": "Shanghai", "last_name": "Haiyi Guo, MD", "_valid": true, "zip": "200032", "country": "China", "id": "fudanuniversitycancerhospital_shanghai_shanghai_cn_200032", "phone": "86(021)64175590", "state": "Shanghai", "location": {"type": "Point", "coordinates": [121.474, 31.23]}, "phone_ext": "5008", "geo": {"lat": 31.23, "lon": 121.474}, "email": "guohaiyi@csco.org.cn", "name": "Fudan University Cancer Hospital"}], "briefTitle": "Endostar Combined With CHOP Regimen as First Line Chemotherapy for Peripheral T Cell Lymphoma", "overallContact": {"phone": "86(021)64175590", "last_name": "Haiyi Guo, MD", "email": "guohaiyi@csco.org.cn", "phone_ext": "5008"}, "link": "http://clinicaltrials.gov/ct2/show/NCT00974324", "studyType": "Interventional", "phase": "Phase 2", "id": "NCT00974324", "tags": [{"priority": 2, "compositeKey": "ALKGENEinclude", "suppress": false, "filterType": "include", "term": "ALK", "custom": false, "facet": "GENE", "alias": "ALK"}, {"priority": 0, "compositeKey": "Lymphoreticular tumourCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Lymphoreticular tumour", "custom": false, "facet": "CONDITION", "alias": "Lymphoreticular tumour", "generatedByTerm": "Malignant lymphoma"}, {"priority": 0, "compositeKey": "Hematologic malignancyCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Hematologic malignancy", "custom": false, "facet": "CONDITION", "alias": "Hematologic malignancy", "generatedByTerm": "Malignant lymphoma"}, {"priority": 0, "compositeKey": "Malignant neoplastic diseaseCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Malignant neoplastic disease", "custom": false, "facet": "CONDITION", "alias": "Cancer", "generatedByTerm": "Malignant lymphoma"}, {"priority": 0, "compositeKey": "Lymphoproliferative disorderCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Lymphoproliferative disorder", "custom": false, "facet": "CONDITION", "alias": "Lymphoproliferative disorder", "generatedByTerm": "Malignant lymphoma"}, {"priority": 0, "compositeKey": "NeoplasiaCONDITIONinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Neoplasia", "custom": false, "facet": "CONDITION", "alias": "Neoplasia", "generatedByTerm": "Malignant lymphoma"}, {"priority": 1, "compositeKey": "Normal breast feedingFINDINGexclude", "suppress": false, "filterType": "exclude", "term": "Normal breast feeding", "custom": false, "facet": "FINDING", "alias": "Breast feeding"}, {"priority": 1, "compositeKey": "Pregnancy confirmedFINDINGexclude", "suppress": false, "filterType": "exclude", "term": "Pregnancy confirmed", "custom": false, "facet": "FINDING", "alias": "Pregnant"}, {"priority": 1, "compositeKey": "VEGFGENEinclude", "suppress": false, "filterType": "include", "term": "VEGF", "custom": false, "facet": "GENE", "alias": "Vascular endothelial growth factor"}, {"priority": 1, "compositeKey": "Congestive cardiac failureCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Congestive cardiac failure", "custom": false, "facet": "CONDITION", "alias": "Congestive cardiac failure"}, {"priority": 1, "compositeKey": "MI - Myocardial infarctionCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "MI - Myocardial infarction", "custom": false, "facet": "CONDITION", "alias": "Heart attack"}, {"priority": 1, "compositeKey": "HF - Heart failureCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "HF - Heart failure", "custom": false, "facet": "CONDITION", "alias": "Heart failure"}, {"priority": 1, "compositeKey": "Phase 2PHASEinclude", "suppress": false, "filterType": "include", "term": "Phase 2", "custom": false, "facet": "PHASE", "alias": "Phase 2"}, {"priority": 1, "compositeKey": "EndostarDRUGinclude", "suppress": false, "filterType": "include", "term": "Endostar", "custom": false, "facet": "DRUG", "alias": "Endostar"}, {"priority": 1, "compositeKey": "Vincristine sulfateDRUGinclude", "suppress": false, "filterType": "include", "term": "Vincristine sulfate", "custom": false, "facet": "DRUG", "alias": "Vincristine sulfate"}, {"priority": 0, "compositeKey": "Vinca AlkaloidDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Vinca Alkaloid", "custom": false, "facet": "DRUGCLASS", "alias": "Vinca Alkaloid", "generatedByTerm": "Vincristine sulfate"}, {"priority": 0, "compositeKey": "ChemotherapyDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Chemotherapy", "custom": false, "facet": "DRUGCLASS", "alias": "Chemotherapy", "generatedByTerm": "Cyclophosphamide"}, {"priority": 1, "compositeKey": "CyclophosphamideDRUGinclude", "suppress": false, "filterType": "include", "term": "Cyclophosphamide", "custom": false, "facet": "DRUG", "alias": "Cyclophosphamide"}, {"priority": 0, "compositeKey": "Alkylating DrugDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Alkylating Drug", "custom": false, "facet": "DRUGCLASS", "alias": "Alkylating Drug", "generatedByTerm": "Cyclophosphamide"}, {"priority": 1, "compositeKey": "Squamous cell carcinoma of skinCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Squamous cell carcinoma of skin", "custom": false, "facet": "CONDITION", "alias": "Squamous cell carcinoma of skin"}, {"priority": 1, "compositeKey": "Malignant neoplasm of skinCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Malignant neoplasm of skin", "custom": false, "facet": "CONDITION", "alias": "Malignant neoplasm of skin"}, {"priority": 1, "compositeKey": "CombinationTRIALTYPEinclude", "suppress": false, "filterType": "include", "term": "Combination", "custom": false, "facet": "TRIALTYPE", "alias": "Combination"}, {"priority": 1, "compositeKey": "InterventionalTRIALTYPEinclude", "suppress": false, "filterType": "include", "term": "Interventional", "custom": false, "facet": "TRIALTYPE", "alias": "Interventional"}, {"priority": 1, "compositeKey": "RadiationDRUGCLASSexclude", "suppress": false, "filterType": "exclude", "term": "Radiation", "custom": false, "facet": "DRUGCLASS", "alias": "Radiation"}, {"priority": 1, "compositeKey": "VEGFDGENEinclude", "suppress": false, "generatedBy": "GENE", "filterType": "include", "term": "VEGFD", "custom": false, "facet": "GENE", "alias": "VEGFD", "generatedByTerm": "VEGF"}, {"priority": 1, "compositeKey": "PIGFGENEinclude", "suppress": false, "generatedBy": "GENE", "filterType": "include", "term": "PIGF", "custom": false, "facet": "GENE", "alias": "PIGF", "generatedByTerm": "VEGF"}, {"priority": 1, "compositeKey": "VEGFAGENEinclude", "suppress": false, "generatedBy": "GENE", "filterType": "include", "term": "VEGFA", "custom": false, "facet": "GENE", "alias": "VEGFA", "generatedByTerm": "VEGF"}, {"priority": 1, "compositeKey": "VEGFBGENEinclude", "suppress": false, "generatedBy": "GENE", "filterType": "include", "term": "VEGFB", "custom": false, "facet": "GENE", "alias": "VEGFB", "generatedByTerm": "VEGF"}, {"priority": 1, "compositeKey": "VEGFCGENEinclude", "suppress": false, "generatedBy": "GENE", "filterType": "include", "term": "VEGFC", "custom": false, "facet": "GENE", "alias": "VEGFC", "generatedByTerm": "VEGF"}]}
"""  # NOQA
PHENOTYPE2 = json.loads(phenotype2, strict=False)  # control character


def convert(dictionary):
    return namedtuple('GenericDict', dictionary.keys())(**dictionary)


def test_convert_association():
    # convert returns a generator
    evidences = list(molecularmatch_trials.convert(EVIDENCE))
    evidence = convert(evidences[0])
    association = convert(evidence.association)
    assert association.evidence_label == 'C'


def test_convert_association2():
    # convert returns a generator
    association = {}
    evidence = {'phase': 'Phase 3'}
    association = el.evidence_label(evidence['phase'],
                                    association, na=False)

    assert association['evidence_label'] == 'B'


def test_convert_phenotype():
    # convert returns a generator
    evidences = list(molecularmatch_trials.convert(PHENOTYPE))
    evidence = convert(evidences[0])
    association = convert(evidence.association)
    assert association.phenotype['description'], \
        'association.phenotype.description empty'
    assert association.phenotype['description'] == 'Tumour of fallopian tube'


def test_convert_phenotype2():
    # convert returns a generator
    evidences = list(molecularmatch_trials.convert(PHENOTYPE2))
    evidence = convert(evidences[0])
    association = convert(evidence.association)
    assert association.phenotype['description'], \
        'association.phenotype.description empty'
    assert association.phenotype['description'] == 'Malignant lymphoma'
